angular.module("app.about",[]).controller("aboutCtrl",function(){}),angular.module("app.addQuestion",[]).controller("addQuestionCtrl",function(e,o,s,t,n,r,a){var l=sessionStorage.id;s.ready(function(){"56a736e5ecc25fc92b468045"!==l?(n.path("/"),t.go("home"),e.isAdmin=!1):"56a736e5ecc25fc92b468045"==l&&(e.isAdmin=!0)}),e.question={},e.saved=function(){console.log(e.question),o.post(a+"/addQuestion",e.question).success(function(o){console.log("Success "+o.msg),e.data=o.msg,r.show(r.simple().textContent(e.data).position("bottom right").hideDelay(3e3))}),e.question=""}}),angular.module("app.contact",[]).controller("contactCtrl",function(e,o,s,t){o.sendto={},o.send=function(){e.post("/emailSend",o.sendto).then(function(e){console.log("got data from Email ",e),console.log(e.data),s.show(s.simple().textContent(e.data.msg).position("bottom right").hideDelay(3e3))},function(e){console.log("Got error from Email ",e),s.show(s.simple().textContent("500 internal Error").position("bottom right").hideDelay(3e3))}),o.sendto=""}});(app=angular.module("app.dash",[])).controller("dashCtrl",function(e,o,s,t,n,r){var a=this,l=sessionStorage.id;a.isAdmin=!1,a.users=[],a.userData=[],"56a736e5ecc25fc92b468045"!==l&&t.go("home"),"56a736e5ecc25fc92b468045"==l&&(a.isAdmin=!0),a.userResults=!1,s.post("/findAllUsers").then(function(o){console.log("Getting response form Users",o);for(var n=0;n<o.data.data.length;n++)a.userData.push(o.data.data[n]);!function(){for(var e=0;a.userData.length&&6!==e;e++)a.users.push(a.userData[e])}(),a.userID=o.data.data;var r=1;document.addEventListener("scroll",function(e){if(r++,81===window.scrollY){for(var o=function(e,o,s){for(var t=[],n=e*s-e;n<e*s;n++)t.push(o[n]);return t}(6,a.userData,r),s=0;s<o.length;s++)a.users.push(o[s]);console.log(a.users)}}),e.showUserResult=function(e){a.users=!1,a.userResults=!0,console.log("userID",e),s.post("/findAllResults",{userID:e}).then(function(e){console.log("user results ",e.data.data),""==e.data.data?(a.users=!1,a.userResults=!1,a.errShow=!0,a.showError="There is no Result to Show"):(a.userResult=e.data.data,a.users=!1,a.userResults=!0,a.errShow=!1)},function(e){console.log("getting error ",e)})},e.deleteUser=function(e,o,n){e=e,o=o;s.post("/deleteUserResult/",{userID:e,userName:o,userMatriculation:n}).then(function(e){console.log("user results ",e);var o=a.users;a.users=i(o,"_id",e.data.data.id),t.go("dashboard")},function(e){console.log("getting error ",e)})}},function(e){console.log("Getting Error",e)});var i=function(e,o,s){for(var t=e.length;t--;)e[t]&&e[t].hasOwnProperty(o)&&arguments.length>2&&e[t][o]===s&&e.splice(t,1);return e}}),angular.module("app.getQuestion",[]).controller("getQuizCtrl",function(e,o,s,t,n,r,a,l){e.isLogin=!1;var i=sessionStorage.id,u=sessionStorage.userName;t.ready(function(){null==i?(e.isLogin=!1,a.go("home")):e.isLogin=!0}),e.select={},o.signOut=function(){o.isLogin=!1,localStorage.clear(),sessionStorage.clear(),a.go("home")},e.counter=100;var c;e.countdown=function(){c=r(function(){e.counter--,e.countdown()},1e3),0==e.counter&&e.stop()},e.stop=function(){e._quiz_start=!1,e.result=!0,e._quiz_start=!1,e.results_result=!0,e.lastResult=!0,e.quiz_box=!1,e.info_box=!1,r.cancel(c)},e.questionArray=[],e._quiz_start=!0,e.QuestionNo=0;var d;e.startQuiz=function(){e.result=!1,e._quiz_start=!1,e.lastResult=!1,e.quiz_box=!0,e.info_box=!1,s.post("/getquizes",{paper:e.select.selectedPaper}).then(function(o){e.questionArray=o.data.data,console.log("queis array",o.data.data),""==e.questionArray&&(e.noQuiz=!0,e.quiz_box=!1);var s=o.data._id;console.log("get Quiz ID : ",s),console.log("Papers : ",e.questionArray),e.quiz=e.questionArray[e.QuestionNo],console.log("$scope.quiz",e.quiz.question)},function(e){console.log("Request not send on server",e)})},e.selectedOption={},e.correct=0,e.percentage=0,e.result=!1,e.nextQuestion=function(){if(console.log("Right Answer ",e.quiz.rightAnswer),e.selectedOption.option.toString()===e.quiz.rightAnswer?e.correct++:e.correct,e.QuestionNo++,e.quiz=e.questionArray[e.QuestionNo],e.selectedOption="",e.QuestionNo==e.questionArray.length){e.quiz_box=!1,e.result=!0,e.results_result=!0,console.log(e.correct),d=e.correct/e.questionArray.length*100;var o=Math.round(parseInt(d))+"%";e.percentage=o,s.post("/saveResult",{userName:u,quizTopic:e.select.selectedPaper,userID:i,riteans_perc:o}).then(function(e){console.log("data from save result ",e.data)},function(e){console.log("Got err from Save Result ",e)})}},e.lastResult=!1,e.noResult=!1,e.showLastResult=function(){e.result=!1,e._quiz_start=!1,e.results_result=!1,s.post("/showResult",{userID:i}).then(function(o){console.log("Showing result ",o.data.data),null==o.data.data||""==o.data.data?(e.userResult="There is no Result to shown..",e.noResult=!0):(e.noResult=!1,e.results=o.data.data,console.log("Results ",e.results),e.lastResult=!0)},function(e){console.log("Got Error due to ",e)})}}),angular.module("app.home",[]).controller("quizCtrl",function(e,o,s,t){o.ready(function(){null==sessionStorage.id?(s.isLogin=!1,s.isAdmin=!1):s.isLogin=!0}),e.myDate=Date.now()});(app=angular.module("app.signin",[])).controller("loginCtrl",function(e,o,s,t,n,r,a,l){e.user2={},localStorage.clear(),sessionStorage.clear(),n.ready(function(){a.isLogin=!1,a.isAdmin=!1,e.loading=!1;null==sessionStorage.id?(a.isLogin=!1,a.isAdmin=!1,r.go("signin")):(a.isLogin=!0,r.go("getquestion"))}),e.login=function(){null==e.user2.userName||null==e.user2.userPass?(o.show(o.simple().textContent("Please Fill all field...").position("bottom right").hideDelay(3e3)),a.isLogin=!1,e.user2=""):s.post("/loginUser",e.user2).then(function(s){if(console.log("got Data",s),0==s.data.success)o.show(o.simple().textContent("User Name or Password not found...").position("bottom right").hideDelay(3e3)),e.user2="",a.isLogin=!1;else{var n=JSON.stringify(s.data.data._id);console.log("JSON String is ",n);var l=s.data,i=l.data._id;localStorage.setItem("id",i),"admin"==l.data.userName?(a.isAdmin=!0,sessionStorage.setItem("id",i),o.show(o.simple().textContent("Welcome Admin..").position("bottom right").hideDelay(3e3)),a.isLogin=!0,r.go("dashboard")):(sessionStorage.setItem("id",i),t.path("/"),a.isAdmin=!1,a.isLogin=!0)}},function(o){e.user2="",console.log("got err",o)})},a.signOut=function(){a.isLogin=!1,a.isAdmin=!1,localStorage.clear(),sessionStorage.clear(),r.go("home")}}),angular.module("app.questionsList",[]).controller("questionsListCtrl",function(e,o,s,t,n,r,a){e.questions=[],o.ready(function(){s.post("/getAllquestions/",{}).then(function(o){e.questions=o.data.data,console.log("Question Details : "+o.data.data)},function(e){console.log("getting error ",e)}),e.deleteQuestion=function(n){n=n;s.post("/deleteQuestion/",{questionID:n}).then(function(s){console.log("question results ",s);var n=e.questions;e.questions=o(n,"_id",s.data.data.id),t.go("questionList")},function(e){console.log("getting error ",e)})};var o=function(e,o,s){for(var t=e.length;t--;)e[t]&&e[t].hasOwnProperty(o)&&arguments.length>2&&e[t][o]===s&&e.splice(t,1);return e}})}),angular.module("app.signup",[]).controller("signupCtrl",function(e,o,s,t,n){e.user={},e.isSignup=!0,e.userName=!1,e.userEmail=!1,e.userPass=!1,e.userMatriculation=!1,e.userName1=function(){e.userName=!0,e.userEmail=!1},e.userEmail1=function(){e.userName=!1,e.userEmail=!0},e.userPass1=function(){e.userName=!1,e.userEmail=!1},e.userPass2=function(){e.userName=!1,e.userEmail=!1},e.submit=function(){o.post("/registerUser",e.user).then(function(o){null==e.user.userName||null==e.user.userEmail||null==e.user.userPass?(t.show(t.simple().textContent("Please fill all fields").position("bottom right").hideDelay(3e3)),e.user=""):e.user.userPass!==e.user.userPass2?(t.show(t.simple().textContent("Password Combination Failed..").position("bottom right").hideDelay(3e3)),e.user=""):0==o.data.success?(t.show(t.simple().textContent("User Name or Email Already Taken..").position("bottom right").hideDelay(3e3)),e.user=""):(t.show(t.simple().textContent("Success...").position("bottom right").hideDelay(3e3)),e.isSignup=!1,s.go("signin"))},function(o){e.isSignup=!0,console.log("got err",o)})}}),angular.module("app.userprofile",[]).controller("userprofileCtrl",function(e,o,s,t,n){var r,a=sessionStorage.id;t.ready(function(){s.isLogin=null!=a}),console.log("chekck id "+a),o.post("/userProfile/"+a).then(function(e){r=e.data.Data,s.dData=r,console.log("2nd ",s.dData)},function(e){console.log("got Error From User PRofile..",e)}),e.showMyResult=function(){o.post("/showResult",{userID:a}).then(function(o){console.log("Showing result ",o.data),null==o.data||""==o.data?(e.userResult="There is no Result to shown..",e.noResult=!0):(e.noResult=!1,e.results=o.data,console.log("Results ",e.results),e.lastResult=!0)},function(e){console.log("Got Error due to ",e)})}}),angular.module("quizApp").config(function(e,o,s){e.state("home",{url:"/",templateUrl:"../components/home/home.html",controller:"quizCtrl"}).state("signin",{url:"/signin",templateUrl:"../components/login/login.html",controller:"loginCtrl"}).state("signup",{url:"/signup",templateUrl:"../components/signup/signup.html",controller:"signupCtrl"}).state("dashboard",{url:"/dashboard",templateUrl:"../components/dashboard/dash.html",controller:"dashCtrl",controllerAs:"dash",loginCompulsory:!0}).state("getquestion",{url:"/getquestion",templateUrl:"../components/getQuestion/getquestion.html",controller:"getQuizCtrl",loginCompulsory:!0}).state("addquestion",{url:"/addquestion",templateUrl:"../components/addQuestion/addQuestion.html",controller:"addQuestionCtrl",loginCompulsory:!0}).state("questionsList",{url:"/questionsList",templateUrl:"../components/questionsList/questionsList.html",controller:"questionsListCtrl",loginCompulsory:!0}).state("aboutus",{url:"/about",templateUrl:"../components/about/about.html",controller:"aboutCtrl",loginCompulsory:!0}).state("contact",{url:"/contact",templateUrl:"../components/contact/contact.html",controller:"contactCtrl"}).state("userprofile",{url:"/userprofile",templateUrl:"../components/userprofile/userprofile.html",controller:"userprofileCtrl",loginCompulosry:!0}),o.otherwise("/"),s.html5Mode({enabled:!0,requireBase:!1})}).constant("heroku","https://quiz-app.herokuapp.com").run(function(e,o){e.$on("$stateChangeStart",function(e,s){var t=sessionStorage.id;s.loginCompulsory&&t&&(e.preventDefault(),o.go("home"))})}),angular.module("quizApp",["ui.router","checklist-model","ngMaterial","app.home","app.contact","app.signin","app.signup","app.dash","app.about","app.getQuestion","app.addQuestion","app.questionsList","app.userprofile"]);var mongoose=require("mongoose"),validator=require("mongoose-unique-validator"),nodemailer=require("nodemailer");mongoose.connect("mongodb://ghayyas94:12345@ds047865.mongolab.com:47865/quizapp",{useMongoClient:!0});var db=mongoose.connection;mongoose.Promise=global.Promise,mongoose.Promise=require("bluebird"),db.on("connect",function(e){e?console.log("Not connected to the database: "+e):console.log("Successfully connected to MongoDB")});var userSchema=new mongoose.Schema({userName:{type:String,required:!0,index:!0,unique:!0},userEmail:{type:String,required:!0,index:!0,unique:!0},userPass:{type:String,required:!0},Date:{type:String,default:Date.now()},userResult:String}),questionSchema=new mongoose.Schema({question:{type:String,unique:!0},op1:String,op2:String,op3:String,op4:String,rightAnswer:String,questionType:String,questionID:String,quizTopic:String,CreatedAt:{type:String,default:Date.now()}}),resultSchema=new mongoose.Schema({userID:String,userName:String,userMatriculation:String,userEmail:String,quizTopic:String,userResult:String,date:{type:String,default:Date.now()}});userSchema.plugin(validator);var User=mongoose.model("Users",userSchema),Question=mongoose.model("Questions",questionSchema),Result=mongoose.model("Results",resultSchema);exports.registerUser=function(e,o){var s=e.body.userName,t=e.body.userEmail,n=e.body.userPass;new User({userName:s,userEmail:t,userPass:n}).save(function(e,s){e?(o.json({success:!1,message:"Cant register to this user Name",err:e}),console.log("got Err :"+e)):(console.log("Data Recieved",s),o.json({success:!0,message:"Registered","data is":s})),console.log("data Saved")})},exports.loginUser=function(e,o){var s=e.body.userName,t=e.body.userPass;User.findOne({userName:s,userPass:t},function(e,s){e?(console.log("An error has occurred"),o.send("An error has occurred"+e)):s?(console.log("user ID is :",s._id),o.json({success:!0,data:s}),console.log("data posted "+s)):(console.log("record not found"),o.json({success:!1,message:"user Not Found"}))})},exports.addQuestion=function(e,o){var s=e.body,t=new Question({question:s.ques,op1:s.op1,op2:s.op2,op3:s.op3,op4:s.op4,rightAnswer:s.rightAnswer,questionType:s.questionType,quizTopic:s.quizName});Question.findOne({question:e.body.ques},function(e,s){s?(console.log("Data Already exists"),o.json({success:!1,msg:"This Question Already Exists.."})):(console.log("data Doesnt exists.."),o.json({success:!0,msg:"Data Saved.."}),t.save(function(e,s){e?(console.log("Error got "+e),o.json({success:!1,data:e})):(console.log("Request got "+s),o.json({success:!0,data:s}))}))})},exports.getquizes=function(e,o){console.log("getquizes"),console.log(e.body.paper),Question.find({quizTopic:e.body.paper},function(s,t){console.log("find: "+e.body.paper),console.log(s),console.log(t),s?(console.log("got Error "+s),o.json({result:!1,data:null})):(console.log("Got Data ",t),o.json({result:!0,data:t}))})},exports.getAllquestions=function(e,o){console.log("Get all the questions"),Question.find({},function(e,s){e?(console.log("Error while fetching the questions "+e),o.json({result:!1,data:null})):(console.log("The Question List is ",s),o.json({result:!0,data:s}))})},exports.saveResult=function(e,o){var s=e.body.riteans_perc,t=e.body.userID,n=e.body.quizTopic,r=e.body.userName,a=e.body.userMatriculation;console.log(t+"=="+s);var l=new Date;new Result({userID:t,quizTopic:n,userName:r,userMatriculation:a,userResult:s,date:l}).save(function(e,s){e?(console.log("Saving Result Failed.."+e),o.json({success:!1,data:e})):(console.log("Result is Saved..",s,"quizName"),o.json({success:!0,data:s})),console.log("Result Recived.",s)})},exports.showResult=function(e,o){var s=e.body.userName;Result.find({userName:s},function(e,s){e?(console.log("Got Error on Find Results"),o.json({success:!1,data:e})):s?o.json({success:!0,data:s}):(console.log("record Not found"),o.json({success:!1,data:"Record not Found"}))})},exports.userProfile=function(e,o){var s=e.params.uid;console.log(s),User.findById(s,function(e,s){e?(console.log("got error from User Profile",e),o.json({success:!1,Error:e})):(console.log("got Data from user Profile ",s),o.json({success:!0,Data:s}))})},exports.findAllUsers=function(e,o){User.find(function(e,s){e?(console.log("Users not Find.."+e),o.json({success:!1,data:e})):(console.log("Users Finds.. "+s),o.json({success:!0,data:s}))})},exports.deleteResult=function(e,o){var s=e.body.userID,t=e.body.userName;console.log("The UserId is going to Delete : "+s),console.log("The UserName is going to Delete : "+t),Result.deleteOne({userName:t},function(e,o){e?console.log("got err",e):console.log("Result of User Name "+t+"is deleted successfully")}),console.log("The UserId is going to Delete : "+s),User.deleteOne({_id:s},function(e,t){if(e)console.log("got err",e),o.json({success:!1,data:e});else{var n={message:"User is successfully deleted",id:s};console.log("deleted the User ",n),o.json({success:!0,data:n})}})},exports.deleteQuestion=function(e,o){var s=e.body.questionID;console.log("The Question is going to Delete : "+s),Question.deleteOne({_id:s},function(e,t){if(e)console.log("got err",e),o.json({success:!1,data:e});else{var n={message:"Question is successfully deleted",id:s};console.log("deleted the Question ",n),o.json({success:!0,data:n})}})},exports.emailSend=function(e,o){var s=nodemailer.createTransport("SMTP",{service:"Gmail",auth:{user:"anaresh7777@gmail.com",pass:"anaresh@542"}}),t={to:"anaresh7777@gmail.com",subject:"Contact Form Message",from:"Contact Form Request<"+e.query.from+">",html:"From: "+e.query.name+"<br>User's email: "+e.query.user+"<br>Message: "+e.query.text};console.log(t),s.sendMail(t,function(e,s){e?(console.log(e),o.end("error")):(console.log("Message sent: "+s.message),o.end("sent"))})},exports.findAllResults=function(e,o){var s=e.body.userID;console.log(e.body),Result.find({userID:s},function(e,s){e?(console.log("got err",e),o.json({success:!1,data:e})):console.log("got data admin ",s),o.json({success:!0,data:s})})};var express=require("express"),bodyParser=require("body-parser"),methodOverride=require("method-override"),path=require("path"),port=(nodemailer=require("nodemailer"),process.env.PORT||3e3),database=require("./database/database"),app=express(),router=express.Router();app.use(bodyParser.urlencoded({extended:!0})),app.use(bodyParser.json()),app.use(methodOverride());var Ipublic=path.resolve(__dirname,"public");app.use(express.static(Ipublic)),app.all("/*",function(e,o,s){o.header("Access-Control-Allow-Origin","*"),o.header("Access-Control-Allow-Methods","GET,PUT,POST,DELETE"),o.header("Access-Control-Allow-Headers","Content-Type"),s()}),app.post("/registerUser",database.registerUser),app.post("/loginUser",database.loginUser),app.post("/addQuestion",database.addQuestion),app.post("/getquizes",database.getquizes),app.post("/getAllquestions",database.getAllquestions),app.post("/saveResult",database.saveResult),app.post("/showResult",database.showResult),app.post("/userProfile/:uid",database.userProfile),app.post("/findAllUsers",database.findAllUsers),app.post("/findAllResults",database.findAllResults),app.post("/emailSend",database.emailSend),app.post("/deleteUserResult",database.deleteResult),app.post("/deleteQuestion",database.deleteQuestion),app.use(function(e,o){o.sendFile(Ipublic+"/index.html")}),app.listen(port,function(){console.log("Server is starting on port "+port)});